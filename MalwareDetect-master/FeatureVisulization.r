library(readr)  # Load the readr package for reading CSV files
library(ggplot2)  # Load the ggplot2 package for data visualization
library(dplyr)  # Load the dplyr package for data manipulation

# Load the data from the CSV file into a DataFrame
data <- read_csv('train.csv')

# Separate features (X) and target variable (y)
X <- data %>% select(-Result)  # Extract features (exclude the 'Result' column)
y <- data$Result  # Extract the target variable ('Result' column)

# Split the data into training and testing sets
set.seed(42)  # Set the seed for reproducibility
train_index <- sample(1:nrow(data), 0.8 * nrow(data))  # Randomly select indices for training data
X_train <- X[train_index, ]  # Extract training features
X_test <- X[-train_index, ]  # Extract testing features
y_train <- y[train_index]  # Extract training target variable
y_test <- y[-train_index]  # Extract testing target variable

# Calculate the proportion of 'Yes' values for each feature
proportions <- colMeans(X)  # Calculate the mean proportion of 'Yes' values for each feature

# Calculate the z-score for each feature
z_scores <- (proportions - mean(proportions)) / sd(proportions)  # Calculate the z-score using the mean and standard deviation

# Create a data frame for visualization
z_scores_df <- data.frame(Feature = names(z_scores), Z_Score = z_scores)  # Create a data frame with feature names and z-scores

# Visualize the z-scores using ggplot
ggplot(z_scores_df, aes(x = Feature, y = Z_Score, fill = Z_Score > 2)) +  # Create a ggplot object with Feature on x-axis, Z_Score on y-axis, and fill color based on whether Z_Score > 2
  geom_bar(stat = "identity", position = "dodge") +  # Add bar plot with Z_Score values
  scale_fill_manual(values = c("FALSE" = "blue", "TRUE" = "red"), guide = FALSE) +  # Set fill colors for Z_Score > 2 (red) and Z_Score <= 2 (blue)
  labs(title = "Z-Scores of Feature Proportions",  # Add title to the plot
       x = "Feature",  # Add label for x-axis
       y = "Z-Score") +  # Add label for y-axis
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +  # Rotate x-axis labels for better readability
  coord_flip()  # Flip the coordinates to create horizontal bars

# Identify features with z-scores greater than a threshold (e.g., 2)
outliers <- z_scores_df[z_scores_df$Z_Score > 2, ]  # Subset features with Z_Score > 2

print('Features with z-scores greater than 2 (potential outliers):')  # Print message
print(outliers)  # Print features with Z_Score > 2
